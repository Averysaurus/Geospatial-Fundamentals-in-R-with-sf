#
# Geospatial Data in R Workshop
#
# Make sure needed packages are installed
our_packages<- c("ggplot2", "dplyr", "sf", "units", "tmap", "raster", "nngeo")
for (i in our_packages){
if ( i %in% rownames(installed.packages()) == FALSE) {
print(paste(i, "needs to be installed!"))
install.packages(i)
} else {
print(paste0(i, " [", packageVersion(i), "] is already installed!"))
}
}
# Set working directory to folder with workshop files
#setwd("~/Documents/Dlab/workshops/2019/Geospatial-Fundamentals-in-R-with-sf")
SFhomes <- read.csv('data/sf_properties_25ksample.csv',
stringsAsFactors = FALSE)
# Take a look at first 5 rows and a few of the columns
SFhomes[1:5,c("YearBuilt","totvalue","AreaSquareFeet","Neighborhood",
"NumBedrooms")]
setwd("..")
SFhomes <- read.csv('data/sf_properties_25ksample.csv',
stringsAsFactors = FALSE)
# Take a look at first 5 rows and a few of the columns
SFhomes[1:5,c("YearBuilt","totvalue","AreaSquareFeet","Neighborhood",
"NumBedrooms")]
plot(SFhomes$lon, SFhomes$lat) # using base plot function
bart <- read.csv("./data/bart.csv")
# take a look
head (bart)
SFhomes15 <- subset(SFhomes_low2high, as.numeric(SalesYear) == 2015)
SFhomes15 <- subset(SFhomes, as.numeric(SalesYear) == 2015)
plot(SFhomes$lon, SFhomes$lat)
plot(bart$X, bart$Y, add=T)
plot(SFhomes$lon, SFhomes$lat)
points(bart$X, bart$Y, col='red')
warnings()
plot(SFhomes$lon, SFhomes$lat)
points(bart$X, bart$Y, col='red')
landmarks <- read.csv("./data/landmarks.csv")
head(landmarks)
plot(SFhomes$lon, SFhomes$lat)
points(bart$X, bart$Y, col='red')
points(landmarks$X, landmarks$Y, col='green')
head(bart)
head(landmarks)
?plot
plot(SFhomes$lon, SFhomes$lat)
points(bart$X, bart$Y, col='red')
plot(landmarks$X, landmarks$Y, col='green', add=TRUE)
plot(landmarks$X, landmarks$Y, col='green')
plot(1:10);par(new=TRUE)
plot(SFhomes$lon, SFhomes$lat)
plot(bart$X, bart$Y, col='red')
plot(landmarks$X, landmarks$Y, col='green')
plot(1:10);par(new=TRUE)
plot(SFhomes$lon, SFhomes$lat)
plot(bart$X, bart$Y, col='red')
#plot(landmarks$X, landmarks$Y, col='green')
plot(1:10);par(new=FALSE)
plot(SFhomes$lon, SFhomes$lat)
plot(bart$X, bart$Y, col='red')
par(new=FALSE)
plot(SFhomes$lon, SFhomes$lat)
plot(bart$X, bart$Y, col='red')
plot(SFhomes$lon, SFhomes$lat); par(new=TRUE)
plot(bart$X, bart$Y, col='red')
plot(SFhomes$lon, SFhomes$lat); par(new=TRUE)
plot(bart$X, bart$Y, col='red'); par(new=TRUE)
plot(landmarks$X, landmarks$Y, col='green')
plot(SFhomes$lon, SFhomes$lat)
plot(SFhomes$lon, SFhomes$lat)
points(bart$X, bart$Y, col='red')
points(landmarks$X, landmarks$Y, col='green')
head(bart)
head(landmarks)
par(mfrow=c(1,2))
plot(SFhomes$lon, SFhomes$lat)
points(landmarks$X, landmarks$Y, col='green')
par(mfrow=c(1,1))
par(mfrow=c(1,2))
plot(SFhomes$lon, SFhomes$lat)
points(landmarks$X, landmarks$Y, col='green')
par(mfrow=c(1,2))
plot(SFhomes$lon, SFhomes$lat)
plot(landmarks$X, landmarks$Y, col='green')
par(mfrow=c(1,1))
par(mfrow=c(1,2))
plot(SFhomes$lon, SFhomes$lat,
xlab="longitude (homes CRS)",
ylab="latitude (homes CRS)")
plot(landmarks$X, landmarks$Y, col='green',
xlab="longitude (landmarks CRS)",
ylab="latitude (landmarks CRS)")
par(mfrow=c(1,1))
par(mfrow=c(1,2))
plot(SFhomes$lon, SFhomes$lat,
xlab="longitude (homes CRS)",
ylab="latitude (homes CRS)",
main="homes CRS")
plot(landmarks$X, landmarks$Y, col='green',
xlab="longitude (landmarks CRS)",
ylab="latitude (landmarks CRS)",
main="landmarks CRS")
par(mfrow=c(1,1))
plot(SFhomes$lon, SFhomes$lat,
xlab="longitude",
ylab="latitude",
main="homes CRS")
plot(landmarks$X, landmarks$Y, col='green',
xlab="longitude",
ylab="latitude",
main="landmarks CRS")
par(mfrow=c(1,2))
plot(SFhomes$lon, SFhomes$lat,
xlab="longitude",
ylab="latitude",
main="homes CRS")
plot(landmarks$X, landmarks$Y, col='green',
xlab="longitude",
ylab="latitude",
main="landmarks CRS")
par(mfrow=c(1,1))
dir("data", pattern = "sftracts.")
tracts = st_read(dsn = './data', layer = 'sftracts')
library(sf)
tracts = st_read(dsn = './data', layer = 'sftracts')
plot(tracts)
tracts$geometry
tracts$geometry[[1]]
tracts$geometry
class(tracts$geometry)
class(tracts$geometry[[1]])
tracts
plot(geom_sf(tracts))
plot(sf::st_geometry(tracts))
head(SFhomes15)
points(SFhomes15$lon, SFhomes$lat)
points(SFhomes15$lon, SFhomes15$lat)
plot(sf::st_geometry(tracts))
points(SFhomes15$lon, SFhomes15$lat)
st_crs(tracts)
st_crs(SFhomes15, n = 1)
st_crs(SFhomes15)
st_crs(tracts)
st_crs(SFhomes15)
tracts_lonlat = st_transform(tracts, crs = st_crs(SFhomes15_sf))
SFhomes15_sf = st_as_sf(SFhomes15, coords = c('lon', 'lat'), crs = 4326)
tracts_lonlat = st_transform(tracts, crs = st_crs(SFhomes15_sf))
st_crs(SFhomes15_sf)
st_crs(tracts_lonlat)
st_crs(SFhomes15_sf) == st_crs(tracts_lonlat)
plot(sf::st_geometry(tracts_lonlat))
plot(SFhomes15_sf, add=TRUE)
plot(sf::st_geometry(tracts_lonlat))
plot(SFhomes15_sf, add=TRUE)
plot(sf::st_geometry(tracts_lonlat))
plot(SFhomes15_sf, add=TRUE)
plot(sf::st_geometry(SFhomes15_sf), add=TRUE)
plot(sf::st_geometry(tracts_lonlat))
plot(sf::st_geometry(SFhomes15_sf), add=TRUE)
plot(sf::st_geometry(SFhomes15_sf), add=TRUE, col='blue')
plot(sf::st_geometry(tracts_lonlat))
plot(sf::st_geometry(SFhomes15_sf), add=TRUE, col='blue')
landmarks_sf = st_as_sf(landmarks, coords = c('X', 'Y'), crs = 3857)
SFboundary = st_read('./data', 'SFboundary')
SFhighways = st_read('./data', 'SFhighways')
#check the CRS of SFboundary
st_crs(SFboundary) == st_crs(SFhomes15_sf)
#check th CRS of SFhighways
st_crs(SFhighways) == st_crs(SFhomes15_sf)
#it needs to be transformed
SFhighways_lonlat = st_transform(SFhighways, st_crs(SFhomes15_sf))
landmarks_lonlat = st_transform(landmarks_sf, st_crs(SFhomes15_sf))
plot(st_geometry(SFboundary), col='purple')
plot(st_geometry(tracts_lonlat), alpha=0.2, add=T)
plot(st_geometry(SFhighways_lonlat), col='red', add=T)
plot(st_geometry(SFhomes15_sf), col='blue', add=T)
plot(st_geometry(landmarks_sf), col'=green', add=T)
plot(st_geometry(landmarks_sf), col='green', add=T)
landmarks_sf = st_as_sf(landmarks, coords = c('X', 'Y'), crs = 3857)
plot(st_geometry(SFboundary), col='purple')
plot(st_geometry(tracts_lonlat), alpha=0.2, add=T)
plot(st_geometry(SFboundary), col='purple', alpha=0.5)
?sf::plot
plot(st_geometry(SFboundary), col='white', border='purple')
plot(st_geometry(tracts_lonlat), alpha=0.2, add=T)
plot(st_geometry(SFhighways_lonlat), col='red', add=T)
plot(st_geometry(SFhomes15_sf), col='blue', add=T)
plot(st_geometry(landmarks_sf), col='green', add=T)
plot(st_geometry(landmarks_lonlat), col='green', add=T)
plot(st_geometry(landmarks_lonlat), col='green', add=T, pch=2)
plot(st_geometry(landmarks_lonlat), col='green', add=T, pch=9)
plot(st_geometry(landmarks_lonlat), col='green', add=T, pch=11)
plot(st_geometry(landmarks_lonlat), col='green', add=T, pch=21)
plot(st_geometry(landmarks_lonlat), col='green', add=T, pch=16)
plot(st_geometry(SFboundary), col='white', border='purple')
plot(st_geometry(tracts_lonlat), alpha=0.2, add=T)
plot(st_geometry(SFhighways_lonlat), col='red', add=T)
plot(st_geometry(SFhomes15_sf), col='blue', pch=16, add=T, pch=16)
plot(st_geometry(SFhomes15_sf), col='blue', pch=16, add=T, pch=16)
plot(st_geometry(SFhomes15_sf), col='blue', pch=16, add=T)
plot(st_geometry(landmarks_lonlat), col='green', pch=16, add=T)
plot(st_geometry(landmarks_lonlat), col='green', pch=16, cex=5 add=T)
plot(st_geometry(landmarks_lonlat), col='green', pch=16, cex=5, add=T)
plot(st_geometry(landmarks_lonlat), col='green', pch=16, cex=3, add=T)
plot(st_geometry(SFboundary), col='white', border='purple')
plot(st_geometry(tracts_lonlat), alpha=0.2, add=T)
plot(st_geometry(SFhighways_lonlat), col='red', add=T)
plot(st_geometry(SFhomes15_sf), col='blue', pch=16, add=T)
plot(st_geometry(landmarks_lonlat), col='green', pch=16, cex=3, add=T)
plot(st_geometry(SFboundary), col='white', border='purple')
plot(st_geometry(tracts_lonlat), alpha=0.2, add=T)
plot(st_geometry(SFhighways_lonlat), col='red', add=T)
plot(st_geometry(SFhomes15_sf), col='blue', pch=16, add=T)
plot(st_geometry(landmarks_lonlat), col='green', pch=16, cex=2, add=T)
ggplot() + geom_point(data=SFhomes15_sf, aes(x=lon, y=lat, col=totvalue))
library(ggplot2)
library(ggplot2)
ggplot() + geom_point(data=SFhomes15_sf, aes(x=lon, y=lat, col=totvalue))
ggplot() + geom_point(data=SFhomes15, aes(x=lon, y=lat, col=totvalue))
library(tmap)
qtm(SFhomes15_sf)
tmap_mode("view") # set tmap to interactive view mode
qtm(SFhomes15_sf) # Interactive - click on the points
ttm()
ttm()
ttm()
ttm()
ttm()
ggplot() + geom_point(data=SFhomes15_sf, aes(col=totvalue))
ggplot() + geom_point(data=SFhomes15, aes(x=lon, y=lat, col=totvalue))
tm_shape(SFhomes15_sf) +
tm_dots(col="totvalue")
tm_shape(SFhomes15_sf) +
tm_dots(col="totvalue", size = 30)
tm_shape(SFhomes15_sf) +
tm_dots(col="totvalue", size = 5)
tm_shape(SFhomes15_sf) +
tm_dots(col="totvalue", size = 2)
tm_shape(SFhomes15_sf) +
tm_dots(col="totvalue", size = 1)
tm_shape(SFhomes15_sf) +
tm_dots(col="totvalue", size = 0.5)
tm_shape(SFhomes15_sf) +
tm_dots(col="totvalue", size = 0.25)
tm_shape(tracts) +
tm_polygons(col="beige", border.col="red", alpha = 0.4)
tm_shape(SFhighways_lonlat) +
tm_lines(col="black")
# Map the SF Boundary first
overlay_map = tm_shape(SFboundary) +
tm_polygons(col="beige", border.col="black") +
# Overlay the highway lines next
tm_shape(SFhighways_lonlat) +
tm_lines(col="black") +
# Then add the house points
tm_shape(SFhomes15_sf) +
tm_dots(col="totvalue", size=.25)
overlay_map
overlay_map +
tm_shape(landmarks_lonlat) +
tm_dots(col = 'skyblue', size = 2)
overlay_map +
tm_shape(landmarks_sf) +
tm_dots(col = 'skyblue', size = 2)
SFhomes15sf_low2high <- SFhomes15_sf[order(SFhomes15_sf$totvalue, decreasing = FALSE),]
tmap(SFhomes15sf_low2high) +
geom_point(col='totvalue')
tm_shape(SFhomes15sf_low2high) +
geom_point(col='totvalue')
tm_shape(SFhomes15sf_low2high) +
tm_dots(col='totvalue')
overlay_map +
tm_shape(landmarks_sf) +
tm_dots(col = 'skyblue', size = 2)
tm_shape(SFhomes15sf_low2high) +
tm_dots(col='totvalue', size=2)
SFhomes15sf_low2high <- SFhomes15_sf[order(SFhomes15_sf$totvalue, decreasing = TRUE),]
tm_shape(SFhomes15sf_low2high) +
tm_dots(col='totvalue', size=2)
par(mfrow=c(1,2))
tm_shape(SFhomes15sf) +
tm_dots(col='totvalue', size=2)
tm_shape(SFhomes15sf_low2high) +
tm_dots(col='totvalue', size=2)
SFhomes15_sf_low2high <- SFhomes15_sf[order(SFhomes15_sf$totvalue, decreasing = TRUE),]
par(mfrow=c(1,2))
tm_shape(SFhomes15_sf) +
tm_dots(col='totvalue', size=2)
tm_shape(SFhomes15_sf_low2high) +
tm_dots(col='totvalue', size=2)
tm_shape(SFhomes15_sf) +
tm_dots(col='totvalue', size=2)
tm_shape(SFhomes15_sf_low2high) +
tm_dots(col='totvalue', size=2)
tm_shape(SFhomes15_sf) +
tm_dots(col='totvalue', size=1)
tm_shape(SFhomes15_sf_low2high) +
tm_dots(col='totvalue', size=1)
SFhomes15_sf_low2high <- SFhomes15_sf[order(SFhomes15_sf$totvalue, decreasing = FALSE),]
SFhomes15_sf_high2low <- SFhomes15_sf[order(SFhomes15_sf$totvalue, decreasing = TRUE),]
tm_shape(SFhomes15_sf_high2low) +
tm_dots(col='totvalue', size=1)
tm_shape(SFhomes15_sf_low2high) +
tm_dots(col='totvalue', size=1)
par(mfrow=c(1,2))
tm_shape(SFhomes15_sf_high2low) +
tm_dots(col='totvalue', size=1)
tm_shape(SFhomes15_sf_low2high) +
tm_dots(col='totvalue', size=1)
high2low = tm_shape(SFhomes15_sf_high2low) +
tm_dots(col='totvalue', size=1)
low2high = tm_shape(SFhomes15_sf_low2high) +
tm_dots(col='totvalue', size=1)
plot(st_geometry(landm))
x = tmap_mode('plot')
x
tmap_arrange(high2low, low2high)
SFhomes15_sf_low2high <- SFhomes15_sf[order(SFhomes15_sf$totvalue, decreasing = FALSE),]
SFhomes15_sf_high2low <- SFhomes15_sf[order(SFhomes15_sf$totvalue, decreasing = TRUE),]
high2low = tm_shape(SFhomes15_sf_high2low) +
tm_dots(col='totvalue', size=1)
low2high = tm_shape(SFhomes15_sf_low2high) +
tm_dots(col='totvalue', size=1)
tmap_arrange(high2low, low2high)
tm_shape(SFboundary) +
tm_polygons(col="beige", border.col="black") +
tm_shape(SFhighways_lonlat) +
tm_lines(col="black") +
tm_shape(SFhomes15_sf) +
tm_dots(col="totvalue", size=.25,
title = "San Francisco Property Values (2015)") +
tm_layout(inner.margins=c(.05, .2, .15, .05))
tmap_mode('view')
SFhomes15_sf_high2low <- SFhomes15_sf[order(SFhomes15_sf$totvalue, decreasing = TRUE),]
high2low = tm_shape(SFhomes15_sf_high2low) +
tm_dots(col='totvalue', size=1)
low2high = tm_shape(SFhomes15_sf_low2high) +
tm_dots(col='totvalue', size=1)
tmap_arrange(high2low, low2high)
#set mode back to interactive
tmap_mode('view')
tm_shape(SFboundary) +
tm_polygons(col="beige", border.col="black") +
tm_shape(SFhighways_lonlat) +
tm_lines(col="black") +
tm_shape(SFhomes15_sf) +
tm_dots(col="totvalue", size=.25,
title = "San Francisco Property Values (2015)") +
tm_layout(inner.margins=c(.05, .2, .15, .05))
#set mode back to interactive
tmap_mode('view')
tm_shape(SFboundary) +
tm_polygons(col="beige", border.col="black") +
tm_shape(SFhighways_lonlat) +
tm_lines(col="black") +
tm_shape(SFhomes15_sf) +
tm_dots(col="totvalue", size=.05,
title = "San Francisco Property Values (2015)",
popup.vars=c("SalesYear","totvalue","NumBedrooms",
"NumBathrooms","AreaSquareFeet")) +
tm_layout(inner.margins=c(.05, .2, .15, .05)) # bottom, left, top, right
#set mode back to interactive
tmap_mode('view')
tm_shape(SFboundary) +
tm_polygons(col="beige", border.col="black") +
tm_shape(SFhighways_lonlat) +
tm_lines(col="black") +
tm_shape(SFhomes15_sf) +
tm_dots(col="totvalue", size=.05,
title = "San Francisco Property Values (2015)",
popup.vars=c("SalesYear","totvalue","NumBedrooms",
"NumBathrooms","AreaSquareFeet")) +
tm_layout(inner.margins=c(.05, .2, .15, .05)) # bottom, left, top, right
tm_basemap("Stamen.Watercolor") +
tm_shape(SFhomes15_sf) +
tm_dots(col="totvalue", size=.05, title = "San Francisco Property Values (2015)") +
tm_tiles("Stamen.TonerLabels")
fav_map <- tmap_last()
fav_map
plot(st_geometry(SFboundary), col='white', border='purple')
plot(st_geometry(tracts_lonlat), alpha=0.2, add=T)
plot(st_geometry(SFhighways_lonlat), col='red', add=T)
plot(st_geometry(SFhomes15_sf), col='blue', pch=16, add=T)
plot(st_geometry(landmarks_lonlat), col='green', pch=16, cex=2, add=T)
par(mfrow=c(1,1))
plot(st_geometry(SFboundary), col='white', border='purple')
plot(st_geometry(tracts_lonlat), alpha=0.2, add=T)
plot(st_geometry(SFhighways_lonlat), col='red', add=T)
plot(st_geometry(SFhomes15_sf), col='blue', pch=16, add=T)
plot(st_geometry(landmarks_lonlat), col='green', pch=16, cex=2, add=T)
challenge_map_2 = tm_shape(SFboundary) +
tm_polygons(border.col = 'purple', alpha = 0) +
tm_shape(tracts_lonlat) +
tm_polygons(col = 'lightgray', border.col = 'darkgray', alpha = 0.3) +
tm_shape(SFhighways_lonlat) +
tm_lines(col = 'red') +
tm_shape(SFhomes15_sf) +
tm_dots(col = 'totvalue', size = 0.05, palette = '-Blues') +
tm_shape(landmarks_sf) +
tm_dots(col = 'red', size = 0.1)
challenge_map_2
tmap_mode('plot')
challenge_map_2
challenge_map_2 = tm_shape(SFboundary) +
tm_polygons(border.col = 'purple', alpha = 0) +
tm_shape(tracts_lonlat) +
tm_polygons(col = 'lightgray', border.col = 'darkgray', alpha = 0.3) +
tm_shape(SFhighways_lonlat) +
tm_lines(col = 'red') +
tm_shape(SFhomes15_sf) +
tm_dots(col = 'totvalue', size = 0.25, palette = '-Blues') +
tm_shape(landmarks_sf) +
tm_dots(col = 'green', size = 0.5)
tmap_mode('plot')
challenge_map_2
plot(st_geometry(SFboundary), col='white', border='purple')
plot(st_geometry(tracts_lonlat), alpha=0.2, add=T)
plot(st_geometry(SFhighways_lonlat), col='red', add=T)
plot(st_geometry(SFhomes15_sf), col='blue', pch=16, add=T)
plot(st_geometry(landmarks_lonlat), col='green', pch=16, cex=2, add=T)
tmap_mode('plot')
challenge_map_2
plot(SFhomes$lon, SFhomes$lat, asp=1) # using base plot function
plot(SFhomes$lon, SFhomes$lat)# asp=1) # using base plot function
plot(SFhomes$lon, SFhomes$lat, asp=1) # using base plot function
plot(SFhomes$lon, SFhomes$lat, asp=1)
points(bart$X, bart$Y, col='red')
?st_transform
